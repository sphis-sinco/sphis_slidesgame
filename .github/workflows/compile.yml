name: Auto-compiled builds (Dekstop)

on:
        push:
                branches-ignore: [randomBranchName]
        pull_request:
                branches-ignore: [randomBranchName]
        workflow_dispatch:

jobs:
        buildLinux:
                runs-on: ubuntu-22.04

                steps:
                        - uses: actions/checkout@main

                        - uses: krdlab/setup-haxe@master
                          with:
                                  haxe-version: 4.3.7

                        - name: Installing Libraries
                          run: haxe --interp -cp ./actions/libs-installer -D analyzer-optimize -main Main
                        - name: Create Version Tag
                          run: echo "${{github.run_id}}" > VERSION

                        - name: Compile
                          run: haxelib run lime build linux -final
                        - name: Publish Artifact
                          uses: actions/upload-artifact@main
                          with:
                                  name: linuxBuild
                                  path: export/final/linux/bin
        buildWindows:
                runs-on: windows-latest

                steps:
                        - uses: actions/checkout@main

                        - uses: krdlab/setup-haxe@master
                          with:
                                  haxe-version: 4.3.7
                        - name: Installing Libraries
                          run: haxe --interp -cp ./actions/libs-installer -D analyzer-optimize -main Main
                        - name: Create Version Tag
                          run: echo "${{github.run_id}}" > VERSION

                        - name: Compile
                          run: haxelib run lime build windows -final
                        - name: Upload Artifact
                          uses: actions/upload-artifact@main
                          with:
                                  name: windowsBuild
                                  path: export/final/windows/bin
        buildMac:
                runs-on: macos-13

                steps:
                        - uses: actions/checkout@main

                        - uses: krdlab/setup-haxe@master
                          with:
                                  haxe-version: 4.3.7

                        - name: Installing Libraries
                          run: haxe --interp -cp ./actions/libs-installer -D analyzer-optimize -main Main
                        - name: Create Version Tag
                          run: echo "${{github.run_id}}" > VERSION

                        - name: Compile
                          run: haxelib run lime build mac -final

                        - name: Publish Artifact
                          uses: actions/upload-artifact@main
                          with:
                                  name: macBuild
                                  path: export/final/macos/bin
        buildHashlink:
                runs-on: windows-latest

                steps:
                        - uses: actions/checkout@main

                        - uses: krdlab/setup-haxe@master
                          with:
                                  haxe-version: 4.3.7
                        - name: Installing Libraries
                          run: haxe --interp -cp ./actions/libs-installer -D analyzer-optimize -main Main
                        - name: Create Version Tag
                          run: echo "${{github.run_id}}" > VERSION

                        - name: Compile
                          run: haxelib run lime build hl -final
                        - name: Publish Artifact
                          uses: actions/upload-artifact@main
                          with:
                                  name: hashlinkBuild
                                  path: export/final/hl/bin